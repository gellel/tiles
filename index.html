<!doctype html>
<html>
	<head>
		<title>double</title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta http-equiv="Content-Language" content="en">
		<meta name="viewport" content="width=device-width, initial-scale=1">
	</head>
	<body>
		<script src="js/prototypes.js"></script>
		<script src="js/keyframe.js"></script>
		<script src="js/queue.js"></script>
		<script src="js/heap.js"></script>
		<script src="js/base.js"></script>
		<script src="js/grid.js"></script>
		<script src="js/graph.js"></script>
		<script src="js/path.js"></script>
		<script src="js/tile.js"></script>
		<script src="js/simplex.js"></script>
		<script src="js/character.js"></script>
		<script src="js/canvas.js"></script>
		<script type="text/javascript">

			var d = [
				{name: "water_ocean", cost: 10, hex: "#25a9cb"},
				{name: "water_sea_deep", cost: 9, hex: "#28aed0"}, 
				{name: "water_sea_medium", cost: 8, hex: "#32b7d8"}, 
				{name: "water_sea_low", cost: 7, hex: "#3dc2e3"}, 
				{name: "water_sea_shallow", cost: 6, hex: "#4ccbeb"}, 
				{name: "water_sea_shore", cost: 4, hex: "#57d8f8"},
				{name: "water_sea_line", cost: 3, hex: "#6ee0fc"},

				{name: "sand_submerged", cost: 3, hex: "#b1e1d1"},
				{name: "sand_coast", cost: 3, hex: "#cae1b1"}, 
				{name: "sand_beach", cost: 3, hex: "#ebe8b5"}, 
				{name: "sand_soft", cost: 3, hex: "#e3dfa1"}, 
				{name: "sand_medium", cost: 2, hex: "#e1dd9d"}, 
				{name: "dirt", cost: 1, hex: "#dbd793"},

				{name: "grass", cost: 0, hex: "#64d977"}, 
				{name: "grass_light", cost: 0, hex: "#56d16a"}, 
				{name: "grass_shallow", cost: 1, hex: "#54ce68"}, 
				{name: "grass_medium", cost: 2, hex: "#4cc760"}, 
				{name: "grass_deep", cost: 3, hex: "#47c55c"},

				{name: "field_open", cost: 1, hex: "#40c155"},
				{name: "field_rise", cost: 1, hex: "#38b94d"},
				{name: "field_incline", cost: 2, hex: "#33b649"},
				{name: "field_alpine", cost: 3, hex: "#50b360"},
				{name: "field_mountain", cost: 4, hex: "#53a260"},
				{name: "field_rocky", cost: 6, hex: "#78a47f"}
			];

			var grid = new Grid({ 
				__init__: true, columns: 120, rows: 60, scale: 10 });


			var graph = new Graph(
				Object.assign(grid.__this__(), { __class__: Tile }));


			var noise = new Simplex(
				{ min: 0, max: d.length, octaves: 20, amplitude: 1.0, frequency: 0.01, distribution: 0.05, persistence: 0.45 });


			var world = new Canvas(
				Object.assign(grid.__this__(), { attr: { style: "position: absolute; z-index: 1;" } }));


			var canvas = new Canvas(
				Object.assign(grid.__this__(), { attr: { style: "position: absolute; z-index: 2;" } }))


			/** set environment geography **/
			graph.editTiles(function (tile) { Object.assign(tile, d[parseInt(noise.process(tile.column, tile.row))]); });
			/** draw environment **/
			graph.getTiles(function (tile) { world.drawGridSquare(tile, { fillStyle: tile.hex }) });



			var path = new Path(Object.assign(graph.__this__(), { __copy__: true }));


			/** land based path **/
			var a = path.astar(0, 0, path.grid.length - 1, path.grid[0].length - 1, { 
				prohibited: { 
					name: ["water_ocean","water_sea_deep","water_sea_medium","water_sea_low","water_sea_shallow"] }, 

				allowed: { 
					name: ["water_sea_shore","water_sea_line","sand_submerged","sand_coast"], cost: [4,5] } 
				});
			
			
			new Queue(a).process(function (t) { canvas.drawGridSquare(t, { fillStyle: "rgba(242, 38, 19, 0.5)"}); });


			path.reset();



			/** water based path **/
			var b = path.astar(0, 0, path.grid.length - 1, path.grid[0].length - 1, { 
				prohibited: { 
					name: ["grass_deep", "grass_medium", "grass_shallow", "grass", "dirt", "sand_medium", "sand_soft"] }, 

				allowed: { 
					name: ["sand_beach", "sand_coast"] } 
				});
			
			
			new Queue(b).process(function (t) { canvas.drawGridSquare(t, { fillStyle: "rgba(102, 51, 153, 0.5)"}); });


			path.reset();




		</script>
	</body>
</html>