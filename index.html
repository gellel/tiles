<!doctype html>
<html>
	<head>
		<title>double</title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta http-equiv="Content-Language" content="en">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" type="text/css" href="css/main.css">
	</head>
	<body class="vh-xs-12 flex-xs pos-xs-relative">
		
		<section id="frame" class="tm-xs-auto rm-xs-auto bm-xs-auto lm-xs-auto z-xs-1 pos-xs-relative"></section>
		<section id="editor" class="t-xs-6 l-xs-6 z-xs-2 pos-xs-absolute"></section>

		<script src="js/prototypes.js"></script>
		<script src="js/keyframe.js"></script>
		<script src="js/queue.js"></script>
		<script src="js/heap.js"></script>
		<script src="js/base.js"></script>
		<script src="js/grid.js"></script>
		<script src="js/graph.js"></script>
		<script src="js/path.js"></script>
		<script src="js/tile.js"></script>
		<script src="js/simplex.js"></script>
		<script src="js/character.js"></script>
		<script src="js/canvas.js"></script>
		<script src="js/editor.js"></script>
		<script type="text/javascript">

			window.getScript("json/tiles_as.js", function () {

				/** set frame container **/
				var frame = document.getElementById("frame");

				/** set editor container **/
				var editor = document.getElementById("editor");

				/** set base grid measurements **/
				window.grid = new Grid(
					{ __init__: true, columns: 80, rows: 60, scale: 10 });

				/** set base graph of grid from default; use tile class for all nodes in graph **/
				window.graph = new Graph(
					Object.assign(grid.__this__(), { __class__: Tile }));

				/** set base canvas for drawing world environment **/
				window.base = new Canvas(
					Object.assign(grid.__this__(), { parent: frame, attr: { style: "position: absolute; z-index: 1" } }));

				/** set base canvas for drawing paths through world **/
				window.dirs = new Canvas(
					Object.assign(grid.__this__(), { parent: frame, attr: { style: "position: absolute; z-index: 2" } }));
				
				/** set base canvas for drawing characters within world **/
				window.stage = new Canvas(
					Object.assign(grid.__this__(), { parent: frame, attr: { style: "position: absolute; z-index: 3" } }));

				/** set base canvas for drawing grid overlay or other ui elements **/
				window.hexg = new Canvas(
					Object.assign(grid.__this__(), { parent: frame, attr: { style: "position: absolute; z-index: 4" } }));

				/** set base textures for world **/
				window.textures = geography.tropic.tiles;

				/** set base simplex processor for world generation **/
				window.simplex = new Simplex({
					amplitude: 0.010, frequency: 0.0110, persistence: 0.44, octaves: 3, max: textures.length, min: 0
				});

				/** set parent frame dimensions **/
				frame.setStyles({ width: grid.width(), height: grid.height() });
				


				function createBias (c1, r1, c2, r2) {

					var cx = c1 / parseFloat(c2);

					var cy = r1 / parseFloat(r2);

					if (!isFinite(cx) || isNaN(cx)) cx = 0;
					if (!isFinite(cy) || isNaN(cy)) cy = 0;

					var fx = cx * 2 - 1;
					var fy = cy * 2 - 1;

					return Math.max(Math.abs(fx), Math.abs(fy));
				}


				

				function createTerrain () {
					graph.getTiles(function (tile) {

						
						var fn = createBias(tile.column, tile.row, tile.columns, tile.rows);

						//var fc = createCurve(fn);

						var a = simplex.noise2d(tile.column, tile.row, fn);
				
						var f = parseInt(Math.abs(a));

						var t = textures[f];


						if (t) base.drawGeometry("fill", tile.x, tile.y, tile.width, tile.height, { fillStyle: t.colour.hex })
						
						

					})
				}
				




				

				createEditor(editor, simplex.getAdjustable(), createTerrain);
				createTerrain();

			}); 




			
		</script>
	</body>
</html>